# # This is a basic workflow to help you get started with Actions
# name: Validate Packer Template

# # Controls when the action will run. Triggers the workflow on push or pull request
# # events but only for the master branch
# on: 
#   push:
#     branches-ignore:
#       - master

#   pull_request:
#     branches-ignore:
#       - master


# # A workflow run is made up of one or more jobs that can run sequentially or in parallel
# jobs:
#   # This workflow contains a single job called "validate"
#   validate:
#     # The type of runner that the job will run on
#     runs-on: ubuntu-22.04
#     # Steps represent a sequence of tasks that will be executed as part of the job
#     steps:
#     # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
#     - name: Run Packer Container - Validate Template
#       # pull official hashicorp packer container for docker hub
#       uses: docker://hashicorp/packer:light

#       with:
#         args: "validate  /github/workspace/webapp-packer/packer/new-aws-ubuntu.pkr.hcl"
     
name: Run packer build on a template file

on:
  push:
    branches:
        - 'master'
jobs:
  packer_build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Packer build
        uses: ExitoLab/packer_build_action_aws@v0.2.10
        with:
          templateFile: 'new-aws-ubuntu.pkr.hcl'
          workingDir: '0.AMI'
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: us-east-1
